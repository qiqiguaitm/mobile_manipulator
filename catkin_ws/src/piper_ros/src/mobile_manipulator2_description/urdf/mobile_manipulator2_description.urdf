<?xml version="1.0" encoding="utf-8"?>
<robot name="mobile_manipulator2">
  
  <!-- Dummy root link to fix KDL inertia warning -->
  <link name="dummy_root"/>
  
  <!-- Connect dummy root to base_link -->
  <joint name="dummy_joint" type="fixed">
    <parent link="dummy_root"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>
  
  <!-- =============================================== -->
  <!-- TRACER2.0 移动底盘部分 -->
  <!-- =============================================== -->
  
  <!-- Base link - 使用tracer2的base_link定义 -->
  <link name="base_link">
    <inertial>
      <origin xyz="-0.037979422359657 -0.00314478249004299 -0.0259198905321653" rpy="0 0 0" />
      <mass value="2.4239552885625" />
      <inertia ixx="0.0691541872284658" ixy="0.000423483205221006" ixz="-0.000201466160013829" iyy="0.0588857794520233" iyz="0.000250049528136794" izz="0.125132015686105" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/base_link.STL" />
      </geometry>
      <material name="tracer2_white">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/base_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <!-- 右驱动轮 - 使用tracer2的轮子定义 -->
  <link name="right_link">
    <inertial>
      <origin xyz="4.7341E-15 1.5543E-15 -0.005" rpy="0 0 0" />
      <mass value="0.14836" />
      <inertia ixx="0.00013099" ixy="3.4159E-20" ixz="-4.7556E-20" iyy="0.00013099" iyz="1.0561E-21" izz="0.00023781" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/right_link.STL" />
      </geometry>
      <material name="tracer2_white">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/right_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="right_joint" type="continuous">
    <origin xyz="-0.018818 -0.2537 -0.0905" rpy="-1.5708 0 0" />
    <parent link="base_link" />
    <child link="right_link" />
    <axis xyz="0 0 1" />
  </joint>
  
  <!-- 左驱动轮 -->
  <link name="left_Link">
    <inertial>
      <origin xyz="-8.2507E-18 0 -0.005" rpy="0 0 0" />
      <mass value="0.14836" />
      <inertia ixx="0.00013099" ixy="6.6936E-21" ixz="1.4318E-19" iyy="0.00013099" iyz="-5.3812E-21" izz="0.00023781" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/left_Link.STL" />
      </geometry>
      <material name="tracer2_white">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/left_Link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="left_joint" type="continuous">
    <origin xyz="-0.018818 0.2537 -0.0905" rpy="1.5708 0 0" />
    <parent link="base_link" />
    <child link="left_Link" />
    <axis xyz="0 0 1" />
  </joint>
  
  <!-- 右前脚轮 -->
  <link name="right_front_link">
    <inertial>
      <origin xyz="-0.013166 2.7397E-05 0.04181" rpy="0 0 0" />
      <mass value="0.2864" />
      <inertia ixx="0.00029479" ixy="5.5901E-08" ixz="5.9543E-05" iyy="0.00032696" iyz="-1.5316E-07" izz="0.00020885" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/right_front_link.STL" />
      </geometry>
      <material name="tracer2_white">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/right_front_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="right_front_joint" type="fixed">
    <origin xyz="0.23918 -0.1977 -0.058" rpy="3.1416 0 0" />
    <parent link="base_link" />
    <child link="right_front_link" />
    <axis xyz="0 0 0" />
  </joint>
  
  <!-- 右后脚轮 -->
  <link name="right_rear_link">
    <inertial>
      <origin xyz="-0.013166 2.7397E-05 0.04181" rpy="0 0 0" />
      <mass value="0.2864" />
      <inertia ixx="0.00029479" ixy="5.5901E-08" ixz="5.9543E-05" iyy="0.00032696" iyz="-1.5316E-07" izz="0.00020885" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/right_rear_link.STL" />
      </geometry>
      <material name="tracer2_white">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/right_rear_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="right_rea_joint" type="fixed">
    <origin xyz="-0.27082 -0.183 -0.058" rpy="3.1416 0 0" />
    <parent link="base_link" />
    <child link="right_rear_link" />
    <axis xyz="0 0 0" />
  </joint>
  
  <!-- 左前脚轮 -->
  <link name="left_front_link">
    <inertial>
      <origin xyz="-0.013166 -2.7397E-05 -0.04181" rpy="0 0 0" />
      <mass value="0.2864" />
      <inertia ixx="0.00029479" ixy="-5.5901E-08" ixz="-5.9543E-05" iyy="0.00032696" iyz="-1.5316E-07" izz="0.00020885" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/left_front_link.STL" />
      </geometry>
      <material name="tracer2_white">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/left_front_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="left_front_joint" type="fixed">
    <origin xyz="0.23918 0.1977 -0.058" rpy="0 0 0" />
    <parent link="base_link" />
    <child link="left_front_link" />
    <axis xyz="0 0 0" />
  </joint>
  
  <!-- 左后脚轮 -->
  <link name="left_rear_link">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <mass value="0" />
      <inertia ixx="0" ixy="0" ixz="0" iyy="0" iyz="0" izz="0" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/left_rear_link.STL" />
      </geometry>
      <material name="tracer2_white">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/meshes/left_rear_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="left_rear_joint" type="fixed">
    <origin xyz="-0.27077 0.18305 -0.058" rpy="0 0 0" />
    <parent link="base_link" />
    <child link="left_rear_link" />
    <axis xyz="0 0 0" />
  </joint>
  
  <!-- =============================================== -->
  <!-- 域控保护壳部分 -->
  <!-- =============================================== -->
  
  <!-- 域控保护壳 - 底盘正上方的保护盒 -->
  <link name="域控保护壳">
    <inertial>
      <mass value="2.0"/>
      <origin xyz="0 0 0.05"/>
      <inertia ixx="0.008" ixy="0" ixz="0" iyy="0.025" iyz="0" izz="0.032"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry>
        <box size="0.4 0.2 0.1"/>
      </geometry>
      <material name="control_box_gray">
        <color rgba="0.3 0.3 0.35 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry>
        <box size="0.4 0.2 0.1"/>
      </geometry>
    </collision>
  </link>

  <!-- 域控保护壳固定安装关节 - 固定连接在底盘正上方 -->
  <joint name="base_to_control_box" type="fixed">
    <parent link="base_link"/>
    <child link="域控保护壳"/>
    <!-- 将域控保护壳安装在底盘上表面，沿x轴后移6cm，z轴贴合底盘上表面 -->
    <origin xyz="-0.06 0 0" rpy="0 0 0"/>
  </joint>

  <!-- =============================================== -->
  <!-- LIDAR 激光雷达部分 -->
  <!-- =============================================== -->
  
  <!-- Lidar 传感器 (优化为更真实的尺寸和外观) -->
  <link name="lidar_link">
    <inertial>
      <mass value="0.83"/>
      <origin xyz="0 0 0.06"/>
      <inertia ixx="0.00052" ixy="0" ixz="0" iyy="0.00052" iyz="0" izz="0.00035"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.06" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.051" length="0.12"/>
      </geometry>
      <material name="lidar_black">
        <color rgba="0.15 0.15 0.15 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.06" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.051" length="0.12"/>
      </geometry>
    </collision>
  </link>

  <!-- Lidar 安装关节 - 固定连接在底盘上表面，相对底盘上表面中心沿x轴正方向20cm，高度12cm -->
  <joint name="base_to_lidar" type="fixed">
    <parent link="base_link"/>
    <child link="lidar_link"/>
    <!-- 将lidar安装在底盘上表面中心前方20cm处，lidar自身高度12cm -->
    <origin xyz="0.2 0 0" rpy="0 0 0"/>
  </joint>

  <!-- FrontCamera Lidar前方摄像头 (优化RealSense外观) -->
  <link name="FrontCamera">
    <inertial>
      <mass value="0.072"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.000034" ixy="0" ixz="0" iyy="0.000162" iyz="0" izz="0.000162"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.09 0.025 0.025"/>
      </geometry>
      <material name="realsense_blue">
        <color rgba="0.15 0.25 0.5 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.09 0.025 0.025"/>
      </geometry>
    </collision>
  </link>

  <!-- FrontCamera安装底座 - 贴合lidar上表面 -->
  <link name="FrontCamera_base_mount">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.000002" ixy="0" ixz="0" iyy="0.000002" iyz="0" izz="0.000002"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.02 0.04 0.005"/>
      </geometry>
      <material name="mount_gray">
        <color rgba="0.6 0.6 0.6 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.02 0.04 0.005"/>
      </geometry>
    </collision>
  </link>

  <!-- FrontCamera垂直支撑杆 - 高度减半 -->
  <link name="FrontCamera_vertical_pole">
    <inertial>
      <mass value="0.0025"/>
      <origin xyz="0 0 0.015"/>
      <inertia ixx="0.0000005" ixy="0" ixz="0" iyy="0.0000005" iyz="0" izz="0.0000005"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.003" length="0.03"/>
      </geometry>
      <material name="mount_gray">
        <color rgba="0.6 0.6 0.6 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.003" length="0.03"/>
      </geometry>
    </collision>
  </link>

  <!-- FrontCamera安装支架 -->
  <link name="FrontCamera_mount">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.000005" ixy="0" ixz="0" iyy="0.000005" iyz="0" izz="0.000005"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.015 0.03 0.02"/>
      </geometry>
      <material name="mount_gray">
        <color rgba="0.6 0.6 0.6 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.015 0.03 0.02"/>
      </geometry>
    </collision>
  </link>

  <!-- FrontCamera底座安装关节 - 贴合lidar上表面，后移2cm -->
  <joint name="lidar_to_base_mount" type="fixed">
    <parent link="lidar_link"/>
    <child link="FrontCamera_base_mount"/>
    <origin xyz="0.041 0 0.1225" rpy="0 0 0"/>
  </joint>

  <!-- FrontCamera垂直支撑杆关节 -->
  <joint name="base_mount_to_pole" type="fixed">
    <parent link="FrontCamera_base_mount"/>
    <child link="FrontCamera_vertical_pole"/>
    <origin xyz="0 0 0.0025" rpy="0 0 0"/>
  </joint>

  <!-- FrontCamera安装支架关节 - 适配支撑杆减半高度 -->
  <joint name="front_camera_pole_to_mount" type="fixed">
    <parent link="FrontCamera_vertical_pole"/>
    <child link="FrontCamera_mount"/>
    <origin xyz="0 0 0.03" rpy="0 0 0"/>
  </joint>

  <!-- FrontCamera Lidar前方摄像头安装关节 - 紧贴支架安装，无空隙 -->
  <joint name="mount_to_FrontCamera" type="fixed">
    <parent link="FrontCamera_mount"/>
    <child link="FrontCamera"/>
    <origin xyz="0.0075 0 0" rpy="0 0 1.5708"/>
  </joint>

  <!-- =============================================== -->
  <!-- 支撑杆、显示器和摄像头部分 -->
  <!-- =============================================== -->
  
  <!-- 0.8m高固定铁杆支撑 (优化外观) -->
  <link name="support_pole">
    <inertial>
      <mass value="1.5"/>
      <origin xyz="0 0 0.4"/>
      <inertia ixx="0.08" ixy="0" ixz="0" iyy="0.08" iyz="0" izz="0.0006"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.4" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.015" length="0.8"/>
      </geometry>
      <material name="pole_silver">
        <color rgba="0.7 0.7 0.75 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.4" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.015" length="0.8"/>
      </geometry>
    </collision>
  </link>

  <!-- 支撑杆固定安装关节 - 固定连接并固定在底盘上表面后方28cm处，不可移动 -->
  <joint name="base_to_support_pole" type="fixed">
    <parent link="base_link"/>
    <child link="support_pole"/>
    <origin xyz="-0.28 0 0" rpy="0 0 0"/>
  </joint>

  <!-- 显示器 (增大尺寸) -->
  <link name="display_screen">
    <inertial>
      <mass value="0.6"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.003" ixy="0" ixz="0" iyy="0.0045" iyz="0" izz="0.003"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.24 0.015 0.16"/>
      </geometry>
      <material name="display_black">
        <color rgba="0.05 0.05 0.05 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.24 0.015 0.16"/>
      </geometry>
    </collision>
  </link>

  <!-- 显示器固定安装关节 - 固定连接并支撑在支撑杆顶部，显示器固定朝向底盘后方（x轴负方向） -->
  <joint name="pole_to_display" type="fixed">
    <parent link="support_pole"/>
    <child link="display_screen"/>
    <origin xyz="0 0 0.75" rpy="0 0 -1.5708" />
  </joint>

  <!-- TopCamera 铁杆顶部摄像头 (优化RealSense外观) -->
  <link name="TopCamera">
    <inertial>
      <mass value="0.072"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.000034" ixy="0" ixz="0" iyy="0.000162" iyz="0" izz="0.000162"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.09 0.025 0.025"/>
      </geometry>
      <material name="realsense_blue">
        <color rgba="0.15 0.25 0.5 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.09 0.025 0.025"/>
      </geometry>
    </collision>
  </link>

  <!-- TopCamera安装支架 -->
  <link name="TopCamera_mount">
    <inertial>
      <mass value="0.1"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.00002" ixy="0" ixz="0" iyy="0.00002" iyz="0" izz="0.00002"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.04 0.05 0.03"/>
      </geometry>
      <material name="mount_gray">
        <color rgba="0.6 0.6 0.6 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.04 0.05 0.03"/>
      </geometry>
    </collision>
  </link>

  <!-- TopCamera安装支架关节 - 贴合支撑杆顶部，无空隙 -->
  <joint name="pole_to_mount" type="fixed">
    <parent link="support_pole"/>
    <child link="TopCamera_mount"/>
    <origin xyz="0.035 0 0.785" rpy="0 0 0"/>
  </joint>

  <!-- TopCamera 铁杆顶部摄像头固定安装关节 - 紧贴支架安装，无空隙 -->
  <joint name="pole_to_TopCamera" type="fixed">
    <parent link="TopCamera_mount"/>
    <child link="TopCamera"/>
    <origin xyz="0.01 0 0" rpy="0 0 1.5708"/>
  </joint>

  <!-- =============================================== -->
  <!-- PIPER 机械臂部分 -->
  <!-- =============================================== -->
  
  <!-- 机械臂安装连接器 - 将piper基座固定在域控保护壳上表面 -->
  <joint name="control_box_to_arm_mount" type="fixed">
    <parent link="域控保护壳"/>
    <child link="arm_base_link"/>
    <!-- 将机械臂基座直接安装在域控保护壳上表面，沿x轴前移6cm -->
    <origin xyz="0.12 0 0.1" rpy="0 0 0"/>
  </joint>
  
  <!-- Piper 机械臂基座 -->
  <link name="arm_base_link">
    <inertial>
      <origin xyz="-0.00473641164191482 2.56829134630247E-05 0.041451518036016" rpy="0 0 0" />
      <mass value="1.02" />
      <inertia ixx="0.00267433" ixy="-0.00000073" ixz="-0.00017389" iyy="0.00282612" iyz="0.0000004" izz="0.00089624" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/base_link.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/base_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <!-- 机械臂关节1 -->
  <link name="arm_link1">
    <inertial>
      <origin xyz="0.000121504734057468 0.000104632162460536 -0.00438597309559853" rpy="0 0 0" />
      <mass value="0.71" />
      <inertia ixx="0.00048916" ixy="-0.00000036" ixz="-0.00000224" iyy="0.00040472" iyz="-0.00000242" izz="0.00043982" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link1.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link1.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint1" type="revolute">
    <origin xyz="0 0 0.123" rpy="0 0 0" />
    <parent link="arm_base_link" />
    <child link="arm_link1" />
    <axis xyz="0 0 1" />
    <limit lower="-2.618" upper="2.618" effort="100" velocity="5" />
  </joint>
  
  <!-- 机械臂关节2 -->
  <link name="arm_link2">
    <inertial>
      <origin xyz="0.198666145229743 -0.010926924140076 0.00142121714502687" rpy="0 0 0" />
      <mass value="1.17" />
      <inertia ixx="0.00116918" ixy="-0.00180037" ixz="0.00025146" iyy="0.06785384" iyz="-0.00000455" izz="0.06774489" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link2.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link2.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint2" type="revolute">
    <origin xyz="0 0 0" rpy="1.5708 -0.1359 -3.1416" />
    <parent link="arm_link1" />
    <child link="arm_link2" />
    <axis xyz="0 0 1" />
    <limit lower="0" upper="3.14" effort="100" velocity="5" />
  </joint>
  
  <!-- 机械臂关节3 -->
  <link name="arm_link3">
    <inertial>
      <origin xyz="-0.0202737662122021 -0.133914995944595 -0.000458682652737356" rpy="0 0 0" />
      <mass value="0.5" />
      <inertia ixx="0.01361711" ixy="0.00165794" ixz="-0.00000048" iyy="0.00045024" iyz="-0.00000045" izz="0.01380322" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link3.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link3.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint3" type="revolute">
    <origin xyz="0.28503 0 0" rpy="0 0 -1.7939" />
    <parent link="arm_link2" />
    <child link="arm_link3" />
    <axis xyz="0 0 1" />
    <limit lower="-2.967" upper="0" effort="100" velocity="5" />
  </joint>
  
  <!-- 机械臂关节4 -->
  <link name="arm_link4">
    <inertial>
      <origin xyz="-9.66635791618542E-05 0.000876064475651083 -0.00496880904640868" rpy="0 0 0" />
      <mass value="0.38" />
      <inertia ixx="0.00018501" ixy="0.00000054" ixz="0.00000120" iyy="0.00018965" iyz="-0.00000841" izz="0.00015484" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link4.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link4.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint4" type="revolute">
    <origin xyz="-0.021984 -0.25075 0" rpy="1.5708 0 0" />
    <parent link="arm_link3" />
    <child link="arm_link4" />
    <axis xyz="0 0 1" />
    <limit lower="-1.745" upper="1.745" effort="100" velocity="5" />
  </joint>
  
  <!-- 机械臂关节5 -->
  <link name="arm_link5">
    <inertial>
      <origin xyz="-4.10554118924211E-05 -0.0566486692356075 -0.0037205791677906" rpy="0 0 0" />
      <mass value="0.383" />
      <inertia ixx="0.00166169" ixy="0.00000006" ixz="-0.00000007" iyy="0.00018510" iyz="0.00001026" izz="0.00164321" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link5.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link5.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint5" type="revolute">
    <origin xyz="0 0 0" rpy="-1.5708 0 0" />
    <parent link="arm_link4" />
    <child link="arm_link5" />
    <axis xyz="0 0 1" />
    <limit lower="-1.22" upper="1.22" effort="100" velocity="5" />
  </joint>
  
  <!-- 机械臂关节6 -->
  <link name="arm_link6">
    <inertial>
      <origin xyz="-8.82590762930069E-05 9.0598378529832E-06 -0.002" rpy="0 0 0" />
      <mass value="0.007" />
      <inertia ixx="5.73015540542155E-07" ixy="-1.98305403089247E-22" ixz="-7.2791893904596E-23" iyy="5.73015540542155E-07" iyz="-3.4146026640245E-24" izz="1.06738869138926E-06" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link6.STL" />
      </geometry>
      <material name="arm_light_blue">
        <color rgba="0.898039215686275 0.917647058823529 0.929411764705882 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link6.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint6" type="revolute">
    <origin xyz="8.8259E-05 -0.091 0" rpy="1.5708 0 0" />
    <parent link="arm_link5" />
    <child link="arm_link6" />
    <axis xyz="0 0 1" />
    <limit lower="-2.0944" upper="2.0944" effort="100" velocity="3" />
  </joint>
  
  <!-- HandCamera 机械臂手部摄像头 (优化RealSense外观) -->
  <link name="HandCamera">
    <inertial>
      <mass value="0.072"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.000034" ixy="0" ixz="0" iyy="0.000162" iyz="0" izz="0.000162"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.09 0.025 0.025"/>
      </geometry>
      <material name="realsense_blue">
        <color rgba="0.15 0.25 0.5 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.09 0.025 0.025"/>
      </geometry>
    </collision>
  </link>

  <!-- HandCamera安装支架 -->
  <link name="HandCamera_mount">
    <inertial>
      <mass value="0.05"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.02 0.04 0.03"/>
      </geometry>
      <material name="mount_gray">
        <color rgba="0.6 0.6 0.6 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.02 0.04 0.03"/>
      </geometry>
    </collision>
  </link>

  <!-- HandCamera安装支架关节 - 贴合机械臂第6关节，无空隙 -->
  <joint name="arm_link6_to_mount" type="fixed">
    <parent link="arm_link6"/>
    <child link="HandCamera_mount"/>
    <origin xyz="-0.03 0 0" rpy="0 0 0"/>
  </joint>

  <!-- HandCamera 机械臂手部摄像头安装关节 - 紧贴支架安装，无空隙 -->
  <joint name="arm_link6_to_HandCamera" type="fixed">
    <parent link="HandCamera_mount"/>
    <child link="HandCamera"/>
    <origin xyz="-0.005 0 0" rpy="0 0 1.5708"/>
  </joint>

  <!-- 夹爪基座 -->
  <link name="arm_gripper_base">
    <inertial>
      <origin xyz="-0.000183807162235591 8.05033155577911E-05 0.0321436689908876" rpy="0 0 0" />
      <mass value="0.45" />
      <inertia ixx="0.00092934" ixy="0.00000034" ixz="-0.00000738" iyy="0.00071447" iyz="0.00000005" izz="0.00039442" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/gripper_base.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/gripper_base.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint6_to_gripper_base" type="fixed">
    <origin xyz="0 0 0" rpy="0 0 0" />
    <parent link="arm_link6" />
    <child link="arm_gripper_base" />
  </joint>
  
  <!-- 夹爪手指1 -->
  <link name="arm_link7">
    <inertial>
      <origin xyz="0.00065123185041968 -0.0491929869131989 0.00972258769184025" rpy="0 0 0" />
      <mass value="0.025" />
      <inertia ixx="0.00007371" ixy="-0.00000113" ixz="0.00000021" iyy="0.00000781" iyz="-0.00001372" izz="0.0000747" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link7.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link7.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint7" type="prismatic">
    <origin xyz="0 0 0.1358" rpy="1.5708 0 0" />
    <parent link="arm_gripper_base" />
    <child link="arm_link7" />
    <axis xyz="0 0 1" />
    <limit lower="0" upper="0.035" effort="100" velocity="1" />
  </joint>
  
  <!-- 夹爪手指2 -->
  <link name="arm_link8">
    <inertial>
      <origin xyz="0.000651231850419722 -0.0491929869131991 0.00972258769184024" rpy="0 0 0" />
      <mass value="0.025" />
      <inertia ixx="0.00007371" ixy="-0.00000113" ixz="0.00000021" iyy="0.00000781" iyz="-0.00001372" izz="0.0000747" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link8.STL" />
      </geometry>
      <material name="arm_blue">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://mobile_manipulator2_description/piper_description/meshes/link8.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="arm_joint8" type="prismatic">
    <origin xyz="0 0 0.1358" rpy="1.5708 0 -3.1416" />
    <parent link="arm_gripper_base" />
    <child link="arm_link8" />
    <axis xyz="0 0 -1" />
    <limit lower="-0.035" upper="0" effort="100" velocity="1" />
  </joint>
  
  <!-- =============================================== -->
  <!-- 传动系统配置 -->
  <!-- =============================================== -->
  
  <!-- 底盘传动 - 适配tracer2.0的双轮差分驱动 -->
  <transmission name="right_wheel_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="right_wheel_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="right_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <transmission name="left_wheel_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="left_wheel_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="left_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <!-- 机械臂传动 -->
  <transmission name="arm_joint1_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="arm_joint1_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="arm_joint1">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <transmission name="arm_joint2_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="arm_joint2_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="arm_joint2">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <transmission name="arm_joint3_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="arm_joint3_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="arm_joint3">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <transmission name="arm_joint4_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="arm_joint4_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="arm_joint4">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <transmission name="arm_joint5_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="arm_joint5_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="arm_joint5">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <transmission name="arm_joint6_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="arm_joint6_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="arm_joint6">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <transmission name="arm_joint7_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="arm_joint7_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="arm_joint7">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <transmission name="arm_joint8_trans" type="SimpleTransmission">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="arm_joint8_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="arm_joint8">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
  </transmission>
  
  <!-- =============================================== -->
  <!-- Gazebo 插件配置 -->
  <!-- =============================================== -->
  
  <gazebo>
    <plugin filename="libgazebo_ros_control.so" name="gazebo_ros_control">
      <robotNamespace>/mobile_manipulator2</robotNamespace>
    </plugin>
  </gazebo>
  
  <!-- 底盘运动控制 - 适配tracer2.0的双轮差分驱动 -->
  <gazebo>
    <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">
      <updateRate>100.0</updateRate>
      <robotNamespace>/mobile_manipulator2</robotNamespace>
      <leftJoint>left_joint</leftJoint>
      <rightJoint>right_joint</rightJoint>
      <wheelSeparation>0.5074</wheelSeparation>
      <wheelDiameter>0.165</wheelDiameter>
      <robotBaseFrame>base_link</robotBaseFrame>
      <torque>30</torque>
      <commandTopic>cmd_vel</commandTopic>
      <broadcastTF>true</broadcastTF>
      <odometryTopic>odom</odometryTopic>
      <odometryFrame>odom</odometryFrame>
      <odometrySource>world</odometrySource>
    </plugin>
  </gazebo>

  <!-- Lidar 传感器Gazebo插件 -->
  <gazebo reference="lidar_link">
    <sensor type="ray" name="lidar_sensor">
      <pose>0 0 0 0 0 0</pose>
      <visualize>true</visualize>
      <update_rate>10</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1</resolution>
            <min_angle>-3.14159</min_angle>
            <max_angle>3.14159</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.1</min>
          <max>10.0</max>
          <resolution>0.01</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin name="lidar_controller" filename="libgazebo_ros_laser.so">
        <topicName>/mobile_manipulator2/scan</topicName>
        <frameName>lidar_link</frameName>
      </plugin>
    </sensor>
    <material>Gazebo/DarkGrey</material>
  </gazebo>

  <!-- TopCamera 铁杆顶部摄像头Gazebo插件 -->
  <gazebo reference="TopCamera">
    <sensor type="depth" name="realsense_depth_sensor">
      <pose>0 0 0 0 0 0</pose>
      <visualize>true</visualize>
      <update_rate>30</update_rate>
      <camera>
        <horizontal_fov>1.047</horizontal_fov>
        <image>
          <width>640</width>
          <height>480</height>
          <format>R8G8B8</format>
        </image>
        <depth_camera>
          <output>
            <type>depth</type>
          </output>
        </depth_camera>
        <clip>
          <near>0.1</near>
          <far>10</far>
        </clip>
      </camera>
      <plugin name="realsense_camera_controller" filename="libgazebo_ros_openni_kinect.so">
        <baseline>0.055</baseline>
        <alwaysOn>true</alwaysOn>
        <updateRate>30.0</updateRate>
        <cameraName>/mobile_manipulator2/TopCamera</cameraName>
        <imageTopicName>color/image_raw</imageTopicName>
        <cameraInfoTopicName>color/camera_info</cameraInfoTopicName>
        <depthImageTopicName>depth/image_raw</depthImageTopicName>
        <depthImageCameraInfoTopicName>depth/camera_info</depthImageCameraInfoTopicName>
        <pointCloudTopicName>depth/points</pointCloudTopicName>
        <frameName>TopCamera</frameName>
        <pointCloudCutoff>0.1</pointCloudCutoff>
        <pointCloudCutoffMax>10.0</pointCloudCutoffMax>
        <hackBaseline>0</hackBaseline>
      </plugin>
    </sensor>
    <material>Gazebo/SkyBlue</material>
  </gazebo>

  <!-- 支撑杆材质 -->
  <gazebo reference="support_pole">
    <material>Gazebo/Silver</material>
  </gazebo>

  <!-- 安装支架材质 -->
  <gazebo reference="TopCamera_mount">
    <material>Gazebo/Grey</material>
  </gazebo>

  <gazebo reference="FrontCamera_base_mount">
    <material>Gazebo/Grey</material>
  </gazebo>

  <gazebo reference="FrontCamera_vertical_pole">
    <material>Gazebo/Grey</material>
  </gazebo>

  <gazebo reference="FrontCamera_mount">
    <material>Gazebo/Grey</material>
  </gazebo>

  <gazebo reference="HandCamera_mount">
    <material>Gazebo/Grey</material>
  </gazebo>

  <!-- 显示器材质 -->
  <gazebo reference="display_screen">
    <material>Gazebo/DarkGrey</material>
  </gazebo>

  <!-- HandCamera 机械臂手部摄像头Gazebo插件 -->
  <gazebo reference="HandCamera">
    <sensor type="depth" name="arm_realsense_depth_sensor">
      <pose>0 0 0 0 0 0</pose>
      <visualize>true</visualize>
      <update_rate>30</update_rate>
      <camera>
        <horizontal_fov>1.047</horizontal_fov>
        <image>
          <width>640</width>
          <height>480</height>
          <format>R8G8B8</format>
        </image>
        <depth_camera>
          <output>
            <type>depth</type>
          </output>
        </depth_camera>
        <clip>
          <near>0.1</near>
          <far>10</far>
        </clip>
      </camera>
      <plugin name="arm_realsense_camera_controller" filename="libgazebo_ros_openni_kinect.so">
        <baseline>0.055</baseline>
        <alwaysOn>true</alwaysOn>
        <updateRate>30.0</updateRate>
        <cameraName>/mobile_manipulator2/HandCamera</cameraName>
        <imageTopicName>color/image_raw</imageTopicName>
        <cameraInfoTopicName>color/camera_info</cameraInfoTopicName>
        <depthImageTopicName>depth/image_raw</depthImageTopicName>
        <depthImageCameraInfoTopicName>depth/camera_info</depthImageCameraInfoTopicName>
        <pointCloudTopicName>depth/points</pointCloudTopicName>
        <frameName>HandCamera</frameName>
        <pointCloudCutoff>0.1</pointCloudCutoff>
        <pointCloudCutoffMax>10.0</pointCloudCutoffMax>
        <hackBaseline>0</hackBaseline>
      </plugin>
    </sensor>
    <material>Gazebo/SkyBlue</material>
  </gazebo>

  <!-- FrontCamera Lidar前方摄像头Gazebo插件 -->
  <gazebo reference="FrontCamera">
    <sensor type="depth" name="lidar_realsense_depth_sensor">
      <pose>0 0 0 0 0 0</pose>
      <visualize>true</visualize>
      <update_rate>30</update_rate>
      <camera>
        <horizontal_fov>1.047</horizontal_fov>
        <image>
          <width>640</width>
          <height>480</height>
          <format>R8G8B8</format>
        </image>
        <depth_camera>
          <output>
            <type>depth</type>
          </output>
        </depth_camera>
        <clip>
          <near>0.1</near>
          <far>10</far>
        </clip>
      </camera>
      <plugin name="lidar_realsense_camera_controller" filename="libgazebo_ros_openni_kinect.so">
        <baseline>0.055</baseline>
        <alwaysOn>true</alwaysOn>
        <updateRate>30.0</updateRate>
        <cameraName>/mobile_manipulator2/FrontCamera</cameraName>
        <imageTopicName>color/image_raw</imageTopicName>
        <cameraInfoTopicName>color/camera_info</cameraInfoTopicName>
        <depthImageTopicName>depth/image_raw</depthImageTopicName>
        <depthImageCameraInfoTopicName>depth/camera_info</depthImageCameraInfoTopicName>
        <pointCloudTopicName>depth/points</pointCloudTopicName>
        <frameName>FrontCamera</frameName>
        <pointCloudCutoff>0.1</pointCloudCutoff>
        <pointCloudCutoffMax>10.0</pointCloudCutoffMax>
        <hackBaseline>0</hackBaseline>
      </plugin>
    </sensor>
    <material>Gazebo/SkyBlue</material>
  </gazebo>

  <!-- tracer2.0底盘材质 -->
  <gazebo reference="base_link">
    <material>Gazebo/White</material>
  </gazebo>

  <gazebo reference="right_link">
    <material>Gazebo/DarkGrey</material>
  </gazebo>

  <gazebo reference="left_Link">
    <material>Gazebo/DarkGrey</material>
  </gazebo>

  <gazebo reference="right_front_link">
    <material>Gazebo/Grey</material>
  </gazebo>

  <gazebo reference="right_rear_link">
    <material>Gazebo/Grey</material>
  </gazebo>

  <gazebo reference="left_front_link">
    <material>Gazebo/Grey</material>
  </gazebo>

  <gazebo reference="left_rear_link">
    <material>Gazebo/Grey</material>
  </gazebo>

  <!-- 域控保护壳材质 -->
  <gazebo reference="域控保护壳">
    <material>Gazebo/DarkGrey</material>
  </gazebo>
  
</robot>