<launch>

  <!-- ============================================= -->
  <!-- Piper MoveIt Demo - 重构版本 -->
  <!-- ============================================= -->

  <!-- 基本参数 -->
  <arg name="pipeline" default="ompl" />
  <arg name="debug" default="false" />
  <arg name="use_rviz" default="true" />
  
  <!-- 模式选择: fake(仿真) 或 real(实机) -->
  <arg name="mode" default="real" />
  
  <!-- 夹爪选择: true(带夹爪) 或 false(不带夹爪) -->
  <arg name="gripper" default="true" />
  
  <!-- 停止按钮选择: true(启用停止按钮) 或 false(禁用) -->
  <arg name="stop_button" default="true" />

  <!-- 根据夹爪选择加载不同的配置 -->
  <group if="$(arg gripper)">
    <!-- 如果启用停止按钮，使用带停止按钮的RViz启动 -->
    <group if="$(arg stop_button)">
      <include file="$(find arm_planner)/moveit_config/piper_with_gripper/launch/demo.launch">
        <arg name="mode" value="$(arg mode)" />
        <arg name="use_rviz" value="false" />
        <arg name="debug" value="$(arg debug)" />
        <arg name="pipeline" value="$(arg pipeline)" />
      </include>
      <!-- 启动RViz和停止按钮 -->
      <include file="$(find arm_planner)/moveit_config/piper_with_gripper/launch/moveit_rviz_with_stop.launch" if="$(arg use_rviz)">
        <arg name="rviz_config" value="$(find arm_planner)/moveit_config/piper_with_gripper/launch/moveit_full.rviz"/>
        <arg name="debug" value="$(arg debug)"/>
      </include>
    </group>
    
    <!-- 如果不启用停止按钮，使用标准启动 -->
    <group unless="$(arg stop_button)">
      <include file="$(find arm_planner)/moveit_config/piper_with_gripper/launch/demo.launch">
        <arg name="mode" value="$(arg mode)" />
        <arg name="use_rviz" value="$(arg use_rviz)" />
        <arg name="debug" value="$(arg debug)" />
        <arg name="pipeline" value="$(arg pipeline)" />
      </include>
    </group>
  </group>
  
  <group unless="$(arg gripper)">
    <include file="$(find arm_planner)/moveit_config/piper_no_gripper/launch/demo.launch">
      <arg name="mode" value="$(arg mode)" />
      <arg name="use_rviz" value="$(arg use_rviz)" />
      <arg name="debug" value="$(arg debug)" />
      <arg name="pipeline" value="$(arg pipeline)" />
    </include>
  </group>

</launch>