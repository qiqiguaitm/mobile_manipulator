<launch>
  <!-- Safe demo with full collision detection -->
  
  <!-- Parameters -->
  <arg name="mode" default="fake" />
  <arg name="use_rviz" default="true" />
  
  <!-- Include standard demo -->
  <include file="$(find arm_planner)/moveit_config/piper_with_gripper/launch/demo.launch">
    <arg name="mode" value="$(arg mode)"/>
    <arg name="use_rviz" value="$(arg use_rviz)"/>
  </include>
  
  <!-- Load ground collision parameters -->
  <rosparam command="load" file="$(find arm_planner)/config/ground_collision.yaml" ns="ground_collision_manager"/>
  
  <!-- Start ground collision manager (wait for move_group) -->
  <node name="ground_collision_manager" 
        pkg="arm_planner" 
        type="ground_collision_manager.py" 
        output="screen"
        launch-prefix="bash -c 'sleep 5; $0 $@'">
    <param name="enable_on_startup" value="true"/>
    <param name="ground_height" value="-0.05"/>
  </node>
  
  <!-- Collision detection verifier (optional) -->
  <node name="collision_verifier" 
        pkg="arm_planner" 
        type="verify_collision_detection.py" 
        output="screen"
        launch-prefix="bash -c 'sleep 8; $0 $@'"
        required="false"/>
</launch>