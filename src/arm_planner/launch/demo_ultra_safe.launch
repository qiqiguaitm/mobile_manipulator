<launch>
  <!-- Ultra-safe demo with enhanced collision detection -->
  
  <!-- Parameters -->
  <arg name="mode" default="fake" />
  <arg name="use_rviz" default="true" />
  
  <!-- Load enhanced collision safety parameters FIRST -->
  <rosparam command="load" file="$(find arm_planner)/config/enhanced_collision_safety.yaml"/>
  
  <!-- Override specific collision padding -->
  <rosparam ns="/move_group/planning_scene_monitor">
    # 确保底盘碰撞检测
    default_robot_padding: 0.04
    
    # 特别保护底盘组件
    link_padding:
      base_link: 0.05
      box_Link: 0.05
      lifting_Link: 0.06
      link1: 0.04
      link2: 0.04
      link3: 0.04
  </rosparam>
  
  <!-- Include standard demo -->
  <include file="$(find arm_planner)/moveit_config/piper_with_gripper/launch/demo.launch">
    <arg name="mode" value="$(arg mode)"/>
    <arg name="use_rviz" value="$(arg use_rviz)"/>
  </include>
  
  <!-- Ground collision manager -->
  <node name="ground_collision_manager" 
        pkg="arm_planner" 
        type="ground_collision_manager.py" 
        output="screen"
        launch-prefix="bash -c 'sleep 5; $0 $@'">
    <param name="enable_on_startup" value="true"/>
    <param name="ground_height" value="-0.05"/>
  </node>
  
  <!-- Chassis collision checker -->
  <node name="chassis_collision_checker" 
        pkg="arm_planner" 
        type="check_chassis_collision.py" 
        output="screen"
        launch-prefix="bash -c 'sleep 8; $0 $@'"
        required="false"/>
  
  <!-- Status message -->
  <node name="safety_status" pkg="rostopic" type="rostopic" 
        args="echo -n 1 /rosout"
        launch-prefix="bash -c 'sleep 10; echo -e \"\n\033[1;32m✅ Ultra-safe mode activated:\033[0m\n - Enhanced collision padding\n - Chassis protection enabled\n - Ground collision active\n - Workspace limits applied\"; exit 0'"/>
</launch>